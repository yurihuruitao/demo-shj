<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDN Connection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-item {
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .test-item.success {
            border-left-color: #27ae60;
            background: #d5f4e6;
        }
        .test-item.error {
            border-left-color: #e74c3c;
            background: #fadbd8;
        }
        .test-item.loading {
            border-left-color: #f39c12;
            background: #fff3cd;
        }
        .url {
            font-family: monospace;
            font-size: 0.9em;
            word-break: break-all;
            flex: 1;
        }
        .status {
            margin-left: 20px;
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
            white-space: nowrap;
        }
        .status.success {
            background: #27ae60;
            color: white;
        }
        .status.error {
            background: #e74c3c;
            color: white;
        }
        .status.loading {
            background: #f39c12;
            color: white;
        }
        .time {
            margin-left: 10px;
            color: #666;
            font-size: 0.9em;
        }
        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .summary h2 {
            margin: 0 0 10px 0;
        }
    </style>
</head>
<body>
    <h1>üåê CDN Connection Test for Azure Japan Server</h1>
    
    <div class="summary" id="summary">
        <h2>Testing CDN connections...</h2>
        <p>Please wait while we test all CDN sources</p>
    </div>

    <div class="test-section">
        <h2>üìö ECharts Library CDN Test</h2>
        <div id="echarts-tests"></div>
    </div>

    <div class="test-section">
        <h2>üó∫Ô∏è China Map Data CDN Test</h2>
        <div id="map-tests"></div>
    </div>

    <script>
        const echartsUrls = [
            'https://unpkg.com/echarts@5.4.3/dist/echarts.min.js',
            'https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js',
            'https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js',
            'https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js',
            'https://fastly.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js',
            'https://lib.baomitu.com/echarts/5.4.3/echarts.min.js'
        ];

        const mapUrls = [
            'https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json',
            'https://unpkg.com/echarts@5.4.3/map/json/china.json',
            'https://cdn.jsdelivr.net/npm/echarts@5.4.3/map/json/china.json',
            'https://fastly.jsdelivr.net/npm/echarts@5.4.3/map/json/china.json'
        ];

        let successCount = 0;
        let errorCount = 0;
        let totalTests = echartsUrls.length + mapUrls.length;

        function testUrl(url, containerId, isScript = false) {
            const container = document.getElementById(containerId);
            const testItem = document.createElement('div');
            testItem.className = 'test-item loading';
            testItem.innerHTML = `
                <div class="url">${url}</div>
                <div>
                    <span class="status loading">Testing...</span>
                    <span class="time"></span>
                </div>
            `;
            container.appendChild(testItem);

            const startTime = Date.now();
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 10000);

            const testMethod = isScript ? testScript : testFetch;
            
            testMethod(url, controller.signal)
                .then(() => {
                    clearTimeout(timeoutId);
                    const duration = Date.now() - startTime;
                    testItem.className = 'test-item success';
                    testItem.querySelector('.status').className = 'status success';
                    testItem.querySelector('.status').textContent = '‚úÖ Success';
                    testItem.querySelector('.time').textContent = `${duration}ms`;
                    successCount++;
                    updateSummary();
                })
                .catch(error => {
                    clearTimeout(timeoutId);
                    const duration = Date.now() - startTime;
                    testItem.className = 'test-item error';
                    testItem.querySelector('.status').className = 'status error';
                    testItem.querySelector('.status').textContent = '‚ùå Failed';
                    testItem.querySelector('.time').textContent = `${duration}ms - ${error.message}`;
                    errorCount++;
                    updateSummary();
                });
        }

        function testFetch(url, signal) {
            return fetch(url, { signal, mode: 'cors' })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    return response.text();
                });
        }

        function testScript(url, signal) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = () => resolve();
                script.onerror = () => reject(new Error('Script load failed'));
                
                signal.addEventListener('abort', () => {
                    script.remove();
                    reject(new Error('Timeout'));
                });
                
                document.head.appendChild(script);
            });
        }

        function updateSummary() {
            const tested = successCount + errorCount;
            if (tested === totalTests) {
                const summaryDiv = document.getElementById('summary');
                const successRate = Math.round((successCount / totalTests) * 100);
                summaryDiv.innerHTML = `
                    <h2>üéØ Test Results</h2>
                    <p style="font-size: 2em; margin: 10px 0;">
                        <strong>${successCount}/${totalTests}</strong> CDNs working
                    </p>
                    <p style="font-size: 1.2em;">Success Rate: ${successRate}%</p>
                    ${successCount > 0 
                        ? '<p style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 4px; margin-top: 15px;">‚úÖ At least one CDN is accessible. Maps should work!</p>' 
                        : '<p style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 4px; margin-top: 15px;">‚ö†Ô∏è No CDNs accessible. Please check network settings or firewall.</p>'}
                `;
            }
        }

        // Run tests
        console.log('üß™ Starting CDN tests...');
        echartsUrls.forEach(url => testUrl(url, 'echarts-tests', false));
        mapUrls.forEach(url => testUrl(url, 'map-tests', false));
    </script>
</body>
</html>
