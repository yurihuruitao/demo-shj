{% extends "base.html" %}

{% block title %}Home - Knowledge Elements{% endblock %}

{% block content %}
<div class="welcome-section">
    <h2>Welcome to Shan Hai Jing Knowledge Elements</h2>
    <p class="intro-text">
        Explore the ancient Chinese classic "Classic of Mountains and Seas" (Â±±Êµ∑Áªè) through our comprehensive knowledge base. 
        Navigate through categories using the sidebar to discover mythical creatures, legendary places, and ancient wisdom.
    </p>
    
    <div class="stats">
        <div class="stat-card">
            <h3>{{ categories|length }}</h3>
            <p>Categories</p>
        </div>
        <div class="stat-card">
            <h3>
                {% set total = namespace(count=0) %}
                {% for category, csv_files in categories.items() %}
                    {% set total.count = total.count + csv_files|length %}
                {% endfor %}
                {{ total.count }}
            </h3>
            <p>Subcategories</p>
        </div>
    </div>
    
    <div class="quick-start">
        <h3>Quick Start</h3>
        <p>Select a category from the sidebar to begin exploring.</p>
        <ul>
            <li>Click on category names to expand subcategories</li>
            <li>Select a subcategory to view items</li>
            <li>Click on any item to see detailed information and images</li>
        </ul>
    </div>
</div>

<!-- Global Knowledge Network -->
{% if global_network_html %}
<div class="global-network-section">
    <h2>üåê Global Knowledge Network</h2>
    <p class="network-intro">
        Interactive visualization of the complete knowledge network from Shan Hai Jing. 
        Nodes represent entities, colors indicate connection density, and edges show relationships.
    </p>
    
    <!-- Top 10 Most Connected Nodes -->
    {% if top_nodes %}
    <div class="top-nodes-section">
        <h3>üèÜ Top 10 Most Connected Entities</h3>
        <div class="top-nodes-grid">
            {% for node in top_nodes %}
            {% if node.csv_path %}
            <a href="{{ url_for('item_detail', csv_path=node.csv_path, item_name=node.name) }}" class="top-node-card" data-rank="{{ loop.index }}">
                <div class="node-rank">{{ loop.index }}</div>
                <div class="node-info">
                    <div class="node-name-pinyin">{{ node.pinyin }}</div>
                    <div class="node-name-chinese">{{ node.name }}</div>
                    <div class="node-connections">
                        <span class="connection-icon">üîó</span>
                        <span class="connection-count">{{ node.count }}</span>
                        <span class="connection-label">links</span>
                    </div>
                </div>
            </a>
            {% else %}
            <div class="top-node-card" data-rank="{{ loop.index }}">
                <div class="node-rank">{{ loop.index }}</div>
                <div class="node-info">
                    <div class="node-name-pinyin">{{ node.pinyin }}</div>
                    <div class="node-name-chinese">{{ node.name }}</div>
                    <div class="node-connections">
                        <span class="connection-icon">üîó</span>
                        <span class="connection-count">{{ node.count }}</span>
                        <span class="connection-label">links</span>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Node Count Control -->
    <div class="network-controls">
        <form method="get" action="/" class="node-control-form">
            <label for="max_nodes">Number of nodes to display:</label>
            <input type="number" 
                   id="max_nodes" 
                   name="max_nodes" 
                   value="{{ current_max_nodes }}" 
                   min="10" 
                   max="5000" 
                   step="10"
                   placeholder="100">
            <button type="submit" class="btn-update">Update Network</button>
            <span class="current-info">Currently showing: <strong>{{ current_max_nodes }}</strong> nodes</span>
        </form>
    </div>
    
    <div class="global-network-wrapper">
        {{ global_network_html|safe }}
    </div>
</div>
{% endif %}
{% endblock %}
