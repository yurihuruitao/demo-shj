# Flask 应用新增功能说明

## 新增功能概览

### 1. 知识网络图可视化 📊
- **位置**: 每个知识元的详情页底部
- **功能**: 
  - 基于 `shanhaijing_cooccurrence_expanded_result.csv` 数据生成交互式网络图
  - 中心节点（红色）表示当前知识元
  - 外围节点（蓝色）表示相关实体
  - 连线上标注关系类型（如"居住"、"流出"、"治疗"等）
  - 自动过滤"无关"关系，只展示有意义的连接
- **技术**: 使用 Plotly + NetworkX 生成响应式图表
- **交互**: 支持缩放、平移、悬停查看节点名称

### 2. 原文与章节信息 📖
- **位置**: 详情页顶部（图片下方）
- **显示内容**:
  - **章节**: 知识元出处章节（如《中山經》）
  - **原文**: 完整的古文原文段落
  - 原文使用楷体字体，提升阅读体验
- **样式**: 渐变背景 + 白色文本框，突出显示

### 3. 多处出现列表 🔍
- **功能**: 如果同一知识元在多个章节中出现，显示所有出处
- **显示**: 
  - 折叠式列表，最多显示 400px 高度（可滚动）
  - 每个条目显示章节名和对应原文
  - 按出现顺序排列
- **样式**: 左侧蓝色边框，清晰区分不同出处

## 文件结构

### 新增文件
```
network_generator.py          # 网络图生成模块
  ├─ load_cooccurrence_data() # 加载共现数据
  ├─ get_item_relationships()  # 获取实体关系
  ├─ create_network_graph()    # 生成 Plotly 图表
  └─ get_all_occurrences()     # 获取所有出现位置
```

### 修改文件
```
app.py                        # 集成网络图功能
templates/detail.html         # 添加网络图、原文、章节显示
static/css/style.css          # 新增样式（约 120 行）
requirements.txt              # 添加 plotly, networkx 依赖
```

## 使用说明

### 启动应用
```bash
python app.py
```

### 访问示例
1. 访问 http://localhost:5000
2. 选择任意分类（如 Animal → Bird name）
3. 点击任意知识元（如"烏"）
4. 在详情页查看：
   - 章节信息和原文（顶部）
   - 图片和英文描述（中部）
   - 交互式网络图（底部）

## 数据源

### shanhaijing_cooccurrence_expanded_result.csv
**列结构**:
- `名字`: 知识元名称
- `原文行`: 完整古文原文
- `章节`: 所属章节
- `相关人物`: 逗号分隔的相关实体列表
- `关系`: 对应的关系类型列表
- `名字（拼音）`: 拼音转写
- `相关人物（拼音）`: 相关实体拼音

**关系类型**:
- 有效关系: "居住"、"流出"、"治疗"、"生长"、"包含"等
- 无效关系: "无关"（会被过滤）

## 响应式设计

### 桌面端 (>1200px)
- 详情页采用双栏布局（图片 | 信息）
- 网络图宽度 900px，高度 600px

### 平板端 (768px-1200px)
- 详情页改为单栏布局
- 网络图自适应容器宽度

### 移动端 (<768px)
- 所有内容单栏垂直排列
- 网络图标题缩小至 1.4rem
- 出现列表最大高度 300px

## 技术栈

- **后端**: Flask 3.0.0
- **数据处理**: pandas 2.1.4
- **可视化**: 
  - Plotly 5.18.0（交互式图表）
  - NetworkX 3.2.1（图论算法）
- **前端**: 
  - HTML5 + Jinja2 模板
  - CSS3（Grid, Flexbox, 渐变）
  - Plotly.js（CDN）

## 性能优化

1. **启动时加载**: CSV 数据在应用启动时加载一次，存储在内存中
2. **按需生成**: 网络图仅在访问详情页时动态生成
3. **CDN 资源**: Plotly.js 从 CDN 加载，减少服务器负担
4. **响应式图表**: Plotly 配置 `responsive: True`，自适应容器

## 未来改进方向

1. **缓存机制**: 缓存已生成的网络图 HTML
2. **更多可视化**: 添加关系类型统计饼图
3. **搜索功能**: 支持原文内容全文检索
4. **导出功能**: 支持导出网络图为 PNG/SVG
5. **关系过滤**: 允许用户交互式过滤关系类型

---

**最后更新**: 2025-11-08
**作者**: GitHub Copilot
